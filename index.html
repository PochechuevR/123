<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ToDo App</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="bg-gray-100">
    <div class="container mx-auto px-4 py-8">
      <h1 class="text-2xl font-bold mb-4">ToDo App</h1>
      <input id="taskInput" type="text" placeholder="Enter your task" class="border rounded p-2 w-full mb-4" />
      <button onclick="addTask()" class="bg-blue-500 text-white px-4 py-2 rounded">Add Task</button>
      <ul id="tasksList" class="mt-4 space-y-2"></ul>
    </div>

    <script>
      const firebaseConfig = {
        apiKey: "AIzaSyCEaHe1v0mB65FL0EVplTMD7BBiPy0DQpA",
        authDomain: "todoapptelegram-48b63.firebaseapp.com",
        projectId: "todoapptelegram-48b63",
        storageBucket: "todoapptelegram-48b63.appspot.com",
        messagingSenderId: "1091616428752",
        appId: "1:1091616428752:web:a8578d65a3d47cb1f504e1",
        databaseURL: "https://todoapptelegram-48b63-default-rtdb.europe-west1.firebasedatabase.app/",
      };

      firebase.initializeApp(firebaseConfig);
      const database = firebase.database();

      function addTask() {
        const taskInput = document.getElementById("taskInput");
        const taskText = taskInput.value;
        if (taskText.trim() !== "") {
          const newTaskRef = database.ref("tasks").push();
          newTaskRef.set({
            text: taskText,
            completed: false,
            subtasks: {},
          });
          taskInput.value = "";
        }
      }

      function toggleTask(key, currentStatus) {
        database.ref("tasks/" + key).update({ completed: !currentStatus });
      }

      function deleteTask(key) {
        database.ref("tasks/" + key).remove();
      }

      function addSubtask(taskKey, subtaskInput) {
        const subtaskText = subtaskInput.value;
        if (subtaskText.trim() !== "") {
          const newSubtaskRef = database.ref(`tasks/${taskKey}/subtasks`).push();
          newSubtaskRef.set({
            text: subtaskText,
            completed: false,
          });
          subtaskInput.value = "";
        }
      }

      function toggleSubtask(taskKey, subtaskKey, currentStatus) {
        database.ref(`tasks/${taskKey}/subtasks/${subtaskKey}`).update({ completed: !currentStatus });
      }

      function renderTasks(tasks) {
        const tasksList = document.getElementById("tasksList");
        tasksList.innerHTML = "";
        for (const key in tasks) {
          const task = tasks[key];

          const li = document.createElement("li");
          li.className = "bg-white p-4 rounded shadow";

          const checkbox = document.createElement("input");
          checkbox.type = "checkbox";
          checkbox.checked = task.completed;
          checkbox.className = "mr-2";
          checkbox.onchange = () => toggleTask(key, task.completed);

          const span = document.createElement("span");
          span.textContent = task.text;
          span.className = task.completed ? "line-through" : "";

          const deleteBtn = document.createElement("button");
          deleteBtn.textContent = "Delete";
          deleteBtn.className = "ml-4 text-red-500";
          deleteBtn.onclick = () => deleteTask(key);

          li.appendChild(checkbox);
          li.appendChild(span);
          li.appendChild(deleteBtn);

          const subtasksContainer = document.createElement("ul");
          subtasksContainer.className = "ml-6 mt-2 space-y-1";

          if (task.subtasks) {
            for (const subtaskKey in task.subtasks) {
              const subtask = task.subtasks[subtaskKey];

              const subLi = document.createElement("li");
              subLi.className = "flex items-center";

              const subCheckbox = document.createElement("input");
              subCheckbox.type = "checkbox";
              subCheckbox.checked = subtask.completed;
              subCheckbox.className = "mr-2";
              subCheckbox.onchange = () => toggleSubtask(key, subtaskKey, subtask.completed);

              const subSpan = document.createElement("span");
              subSpan.textContent = subtask.text;
              subSpan.className = subtask.completed ? "line-through" : "";

              subLi.appendChild(subCheckbox);
              subLi.appendChild(subSpan);
              subtasksContainer.appendChild(subLi);
            }
          }

          const subtaskInput = document.createElement("input");
          subtaskInput.placeholder = "Enter subtask";
          subtaskInput.className = "border rounded p-1 text-sm w-3/4 mt-2";

          const addSubtaskBtn = document.createElement("button");
          addSubtaskBtn.textContent = "Add Subtask";
          addSubtaskBtn.className = "ml-2 text-blue-500 text-sm";
          addSubtaskBtn.onclick = () => addSubtask(key, subtaskInput);

          li.appendChild(subtasksContainer);
          li.appendChild(subtaskInput);
          li.appendChild(addSubtaskBtn);

          tasksList.appendChild(li);
        }
      }

      database.ref("tasks").on("value", (snapshot) => {
        const tasks = snapshot.val();
        renderTasks(tasks || {});
      });
    </script>
  </body>
</html>
